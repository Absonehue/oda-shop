<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODA SHOP | L'Art du Parfum</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Montserrat:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #fdfbf8; --accent: #d4af37; --text: #2c2c2c; --beige: #f4eee8; --shadow: rgba(0, 0, 0, 0.05); }
        body { font-family: 'Montserrat', sans-serif; margin: 0; background: var(--primary); color: var(--text); line-height: 1.8; overflow-x: hidden; }
        h1, h2, h3 { font-family: 'Cormorant Garamond', serif; font-weight: 600; text-transform: uppercase; letter-spacing: 3px; }
        
        nav { background: rgba(255, 255, 255, 0.8); padding: 25px 0; text-align: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.03); backdrop-filter: blur(15px); }
        nav h1 { margin: 0; font-size: 1.8em; color: var(--text); }
        
        /* Notification ajout panier */
        #toast { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: var(--text); color: white; padding: 10px 30px; border-radius: 5px; opacity: 0; transition: 0.5s; z-index: 3000; font-size: 0.8em; letter-spacing: 1px; }

        .cart-link { position: fixed; top: 30px; right: 40px; background: var(--text); color: white; padding: 12px 25px; border-radius: 50px; text-decoration: none; font-size: 0.75em; font-weight: 500; z-index: 2000; box-shadow: 0 10px 20px rgba(0,0,0,0.1); transition: 0.4s ease; }
        .whatsapp-float { position: fixed; bottom: 30px; right: 40px; background-color: #25d366; color: white; width: 60px; height: 60px; border-radius: 50px; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 25px rgba(0,0,0,0.15); z-index: 3000; transition: 0.4s ease; text-decoration: none; }
        
        .hero { position: relative; height: 80vh; display: flex; align-items: center; justify-content: center; background: var(--beige); overflow: hidden; }
        .hero video { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0.9; }
        
        .mute-control { position: absolute; bottom: 30px; left: 40px; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1500; transition: 0.3s; }
        .mute-control:hover { background: rgba(255, 255, 255, 0.4); transform: scale(1.1); }
        .mute-control svg { width: 20px; height: 20px; fill: white; }

        .container { width: 90%; max-width: 1400px; margin: auto; padding: 100px 0; }
        .catalogue { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 60px; }
        
        .card { background: transparent; border: none; position: relative; transition: 0.5s; }
        .image-box { position: relative; height: 450px; background: white; overflow: hidden; display: flex; align-items: center; justify-content: center; box-shadow: 0 15px 35px var(--shadow); cursor: pointer; }
        .image-box img { max-width: 70%; transition: 0.6s ease; }
        
        .overlay { position: absolute; inset: 0; background: rgba(253, 251, 248, 0.96); display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; opacity: 0; transition: 0.4s; }
        .card:hover .overlay { opacity: 1; }
        .card:hover .image-box img { transform: scale(1.1); filter: blur(2px); }
        
        .card-body { padding: 30px 10px; text-align: center; }
        .price { color: var(--accent); font-weight: 400; font-size: 1.2em; display: block; margin-bottom: 20px; }
        .btn-add { border: 1px solid var(--text); color: var(--text); padding: 15px 30px; text-decoration: none; font-size: 0.8em; text-transform: uppercase; letter-spacing: 2px; transition: 0.4s; display: inline-block; cursor: pointer; }
        
        .rdv-section { background: white; padding: 80px; box-shadow: 0 30px 60px var(--shadow); margin-top: 100px; text-align: center; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 900px; margin: auto; }
        input, select { padding: 20px; border: 1px solid #eee; background: var(--primary); outline: none; }
        .btn-submit { grid-column: span 2; background: var(--text); color: white; border: none; padding: 20px; text-transform: uppercase; letter-spacing: 5px; cursor: pointer; }
    </style>
</head>
<body>

<nav><h1>ODA SHOP</h1></nav>

<div id="toast">Article ajouté au panier</div>

<a href="{{ url_for('afficher_panier') }}" id="cart-counter" class="cart-link">Mon Panier ({{ nb_articles }})</a>

<a href="#" id="whatsappLink" class="whatsapp-float">
    <svg width="35" height="35" viewBox="0 0 24 24" fill="white"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766 0-3.18-2.587-5.771-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.502-2.961-2.617-.087-.116-.708-.94-.708-1.793s.448-1.273.607-1.446c.159-.173.346-.217.462-.217l.332.006c.106.005.249-.04.39.298.144.347.491 1.2.534 1.287.043.087.072.188.014.304-.058.116-.087.188-.173.289l-.26.304c-.087.101-.177.211-.077.383.1.173.444.733.953 1.185.656.584 1.21.765 1.382.852.173.087.274.072.376-.043l.433-.505c.101-.116.202-.087.347-.029l1.285.607c.144.058.241.087.29.173.048.086.048.498-.096.903z"></path></svg>
</a>

<section class="hero">
    <video autoplay muted loop playsinline id="heroVideo">
        <source src="{{ url_for('static', filename='images/hero_video.mp4') }}" type="video/mp4">
    </video>
    <div id="muteBtn" class="mute-control">
        <svg id="muteIcon" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zM3 9v6h4l5 5V4L7 9H3z"></path></svg>
    </div>
</section>

<div class="container">
    <div class="catalogue">
        {% for p in parfums %}
        <div class="card">
            <div class="image-box" onclick="remplirForm('{{ p.nom }}')">
                <img src="{{ url_for('static', filename='images/' + p.image) }}" alt="{{ p.nom }}">
                <div class="overlay">
                    <p style="font-family: 'Cormorant Garamond'; font-size: 1.4em; color: var(--text); font-style: italic; max-width: 280px; text-align: center;">
                        "{{ p.desc }}"
                    </p>
                    <div style="width: 40px; height: 1px; background: var(--accent); margin: 20px 0;"></div>
                    <span style="font-size: 0.7em; letter-spacing: 2px; text-transform: uppercase;">Réserver une expérience</span>
                </div>
            </div>

            <div class="card-body">
                <h3>{{ p.nom }}</h3>
                <span class="price">{{ p.prix | format_prix }}</span>
                <a href="javascript:void(0)" onclick="ajouterAuPanier({{ p.id }})" class="btn-add">Ajouter au panier</a>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="rdv-section" id="form-rdv">
        <h2>Atelier Olfactif</h2>
        <form action="/rdv" method="POST" class="form-grid">
            <input type="text" name="nom" placeholder="Nom Complet" required>
            <input type="email" name="email" placeholder="Adresse Email" required>
            <select name="parfum" id="parfum-select">
                {% for p in parfums %}
                <option value="{{ p.nom }}">{{ p.nom }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn-submit">Confirmer l'atelier</button>
        </form>
    </div>
</div>

<script>
    // 1. AJOUT AU PANIER SANS ACTUALISER (AJAX)
    function ajouterAuPanier(id) {
        fetch('/ajouter_au_panier/' + id)
        .then(response => response.json())
        .then(data => {
            if(data.status === "success") {
                // Mise à jour du compteur
                document.getElementById('cart-counter').textContent = 'Mon Panier (' + data.nb_articles + ')';
                
                // Petite notification visuelle
                const toast = document.getElementById('toast');
                toast.style.opacity = '1';
                setTimeout(() => { toast.style.opacity = '0'; }, 2000);
            }
        })
        .catch(err => console.error("Erreur panier:", err));
    }

    // 2. Remplissage auto du formulaire
    function remplirForm(nom) {
        document.getElementById('parfum-select').value = nom;
        document.getElementById('form-rdv').scrollIntoView({ behavior: 'smooth' });
    }

    // 3. Gestion du Son Vidéo
    const video = document.getElementById('heroVideo');
    const muteBtn = document.getElementById('muteBtn');
    const muteIcon = document.getElementById('muteIcon');
    const soundOnIcon = '<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path>';
    const soundOffIcon = '<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"></path>';

    muteBtn.addEventListener('click', () => {
        if (video.muted) {
            video.muted = false;
            muteIcon.innerHTML = soundOnIcon;
        } else {
            video.muted = true;
            muteIcon.innerHTML = soundOffIcon;
        }
    });

    // 4. WhatsApp & Initialisation
    window.onload = function() {
        const phone = "2250506177697";
        let text = "Bonjour ODA SHOP, j'aimerais avoir des informations sur votre collection.";
        const waLink = document.getElementById('whatsappLink');
        if(waLink) waLink.href = "https://wa.me/" + phone + "?text=" + encodeURIComponent(text);
    };
</script>

</body>
</html>